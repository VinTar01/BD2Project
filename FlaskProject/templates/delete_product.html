<!DOCTYPE html>
<html>
<head>
  <title>Elimina Prodotto</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/delete_product.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/header.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">
  <style>
    /* Modale sfondo */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
      background-color: #fff;
      margin: 15% auto;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      max-width: 400px;
      text-align: center;
      font-size: 18px;
      color: #333;
    }

    .modal-buttons {
      margin-top: 20px;
    }

    .modal-buttons button {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 10px 22px;
      margin: 0 15px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }

    .modal-buttons button:hover {
      background-color: #c0392b;
    }
  </style>
</head>
<body>
  {% include 'header.html' %}

  <h1>Elimina Prodotto</h1>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <ul>
        {% for category, message in messages %}
          <li class="{{ category }}">{{ message }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

  <label>Cerca per prefisso:</label>
  <input type="text" id="searchInput" placeholder="Es: iph, sam..." oninput="filterProducts()" style="width: 100%; padding: 10px; margin-bottom: 10px;">

  <p>Seleziona un prodotto da eliminare:</p>

  <form id="deleteForm" method="post" onsubmit="return false;">
    <select id="product_select" name="product_id">
      <option value="">-- Seleziona un prodotto --</option>
      {% for p in products %}
        <option value="{{ p.product_id }}">{{ p.product_name }}</option>
      {% endfor %}
    </select>
    <button type="submit" id="deleteBtn">Elimina Prodotto</button>
  </form>


  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <p>Sei sicuro di voler eliminare questo prodotto?</p>
      <div class="modal-buttons">
        <button id="confirmYes">SÃ¬</button>
        <button id="confirmNo">No</button>
      </div>
    </div>
  </div>

  <script>
    const modal = document.getElementById('confirmModal');
    const form = document.getElementById('deleteForm');
    const deleteBtn = document.getElementById('deleteBtn');
    const confirmYes = document.getElementById('confirmYes');
    const confirmNo = document.getElementById('confirmNo');
    const select = document.getElementById('product_select');
    const input = document.getElementById('searchInput');

    const products = {{ products|tojson }};

    function filterProducts() {
      const prefix = input.value.toLowerCase();
      select.innerHTML = '<option value="">-- Seleziona un prodotto --</option>';

      products.forEach(p => {
        if (p.product_name.toLowerCase().startsWith(prefix)) {
          const opt = document.createElement('option');
          opt.value = p.product_id;
          opt.textContent = p.product_name;
          select.appendChild(opt);
        }
      });
    }

    deleteBtn.addEventListener('click', () => {
      if (!select.value) {
        alert('Seleziona un prodotto prima di eliminare.');
        return;
      }
      modal.style.display = 'block';
    });

    confirmYes.addEventListener('click', () => {
      form.onsubmit = null;
      form.submit();
    });

    confirmNo.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
  </script>

  {% include 'footer.html' %}
</body>
</html>
